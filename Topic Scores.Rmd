---
title: "Topic Scores"
author: "DARS"
date: "2/18/2019"
output: pdf_document
---
#Set up
##Libraries
```{r libraries}
library(tidyverse)
```

##Raw Data
```{r setup, include=FALSE}
#
##Import d_course and d_transcript
load("Output/data_general.RDATA")
load("Output/data_pillar_1.RDATA")

#
##Import LDA_models
load("Output/topic_model.RDATA")

rm(lists, d_AoD, d_assessment, d_ILO)
```

##Models in list:
```{r models in list}
LDA_models <- list()
LDA_models$description <- LDA_description_35
LDA_models$overview <- LDA_overview_35
LDA_models$manual <- LDA_manual_40

rm(LDA_description_35, LDA_overview_35, LDA_manual_40)
```

## Getting Functions (gamma and beta) 
```{r getting functions}
get_beta <- function(results){
  
  tidy(results, matrix = "beta")           %>%
    mutate(topic = paste("Topic", topic) ) %>%
      arrange(topic, desc(beta) )
  
}

get_gamma <- function(results){
  
  tidy(results, matrix = "gamma")          %>%
    mutate(topic = paste("Topic", topic) ) %>%
      arrange(topic, desc(gamma) )
}

```

##Getting applied (gamma and beta) 
```{r getting beta and gamma}
distribution <- list()

distribution$beta <- lapply(
  LDA_models,
  get_beta
)

distribution$gamma <- lapply(
  LDA_models,
  get_gamma
)

```

##Inspect topics
```{r inspect topics}
inspect_topics <- function(d_beta = distribution$beta){
  d_beta %>%
    group_by(topic) %>%
    top_n(10, beta)
  
}

topics <- lapply(
  distribution$beta,
  inspect_topics
)

#
##View
#View(topics$manual)

```

##Selectig keywords
```{r}
get_top_words <- function(d_beta, n = 3){
  d_beta %>%
    group_by(topic) %>%
    top_n(n, beta) %>%
    pull(term)%>%
    unique
}

kw <- lapply(
  distribution$beta,
  get_top_words
)
```
###Convenience vectors
```{r}
# set seed
set.seed(1)

#
## All courses
course_all <- d_course %>%
  inner_join(
    d_transcript,
    by = "Course ID"
  ) %>%
  distinct(
    `Course ID`
  ) %>%
  # remove semester abroad, skills and projects
  filter(
    ! str_detect(`Course ID`, pattern = "SA|SKI|PRO")
  ) %>%
  pull

#
##courses following_semester
course_following_semester <- sample(
  x       = course_all,
  size    = 60,
  replace = FALSE
  ) %>% sort
```

### Saving files for APP
```{r keywords}
save(distribution, kw, course_all, course_following_semester,
     file = "App/Recommender System/data_topic_models.RDATA")
```
