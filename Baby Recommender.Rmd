---
title: "Pillar A1"
author: "DARS"
date: "2/15/2019"
output: pdf_document
---

```{r library}
library(tidyverse)
```

#Setup
This contains AR and SR
```{r setup}
load("App/rules.RDATA")
load("Output/transaction_df.RDATA")
```

First we gather a sample of students to provide recommendations to. We use `d_transactions$taken_PF_HL`
```{r sample}

student <- "6060984"

students <- unique(d_transactions$taken_PF_HL$sequenceID)
size = floor(length(students)/10)

#
##Sample student IDs
set.seed(123)
s1 <- sample(
  x    = students,
  size = size 
)
#
##Transcripts of selected students
target_transcript <- d_transactions$taken_PF_HL %>%
  filter(
    sequenceID %in% s1
  ) %>%
  select(-`Period (additional)`, -`Period (additional bis)`, -`Concentration (additional)`)

```

For a single student:
```{r truncated transcript}

course_sample_size <- 5

student <- "6036972"

student_transcript <- target_transcript %>% 
    filter(sequenceID == student) %>%
  arrange(Year_numerical, Period)

length_student_transcript <- nrow(student_transcript)

#
##Truncated student transcript
sample_transcript      <- student_transcript[1:course_sample_size,]
prospective_courses <- student_transcript[(course_sample_size+1):(course_sample_size+2),] #%>% 
  #select(sequenceID, `Course ID`)
```


##Matching rules to students:
###Taken
```{r will take}
taken_match <- AR$taken %>%
  left_join(sample_transcript, by = c("lhs"="item"))%>%
  drop_na() %>%
  group_by(rhs) %>%
  mutate(RHS_vote= n())%>%
  arrange(desc(RHS_vote))

recommendations <- taken_match[1:5,] %>% select(rhs)
  

```
####Check
```{r evaluation}
recommendations %>%
  left_join(prospective_courses, by= c("rhs"="Course ID")) %>%
  drop_na()
```
###PF
Note we need to take the d_transactions, not the transcripts! cause we need the columns item_PF
```{r prospective red flag}
prospective_RedFlag <- AR$PF %>%
  left_join(prospective_courses, by = c("lhs"="item_PF"))%>%
  drop_na() %>%
  group_by(rhs) %>%
  mutate(RHS_vote= n())%>%
  arrange(desc(RHS_vote))

```

###HL
```{r expected low result}
expect_low_result <- AR$HL  %>%
  left_join(prospective_courses, by = c("lhs"="item_HL"))%>%
  drop_na() %>%
  group_by(rhs) %>%
  mutate(RHS_vote= n())%>%
  arrange(desc(RHS_vote))

```






















